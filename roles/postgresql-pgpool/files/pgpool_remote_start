#! /bin/sh
if [ $# -ne 2 ]
then
    echo "pgpool_remote_start remote_host remote_datadir"
    exit 1
fi
DEST=$1
DESTDIR=$2

# Expand a base backup.
ssh -T $DEST 'cd /var/lib/postgresql/9.3/main/; tar zxf pgsql.tar.gz' 2>/dev/null 1>/dev/null < /dev/null

# This file has host-specific information generated by ansible. So it needs to be replaced after every recovery.
ssh -T $DEST 'cp /var/lib/postgresql/9.3/pgpool-copy-base-backup /var/lib/postgresql/9.3/main/pgpool-copy-base-backup' 2>/dev/null 1>/dev/null < /dev/null

# Startup PostgreSQL server
ssh -T $DEST 'service postgresql start' 2>/dev/null 1>/dev/null < /dev/null