# Managed by ansible, please do not edit manually as your
# changes are overwritten.

global
       log 127.0.0.1   local0 err
       log 127.0.0.1   local1 err
       stats socket     /var/run/haproxy.sock mode 0600 level admin
       maxconn         4096
       tune.bufsize    32768
       user            haproxy
       group           haproxy
       ssl-default-bind-ciphers ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4
       tune.ssl.default-dh-param 2048
       daemon

defaults
      log             global
      mode            tcp
      option          tcplog
      retries         3
      maxconn         20000
      contimeout      5000
      clitimeout      50000
      srvtimeout      50000
      no option       checkcache

listen pgsql 0.0.0.0:5432
    mode tcp
    option  httpchk
    default-server port 5432 inter 2s downinter 5s rise 3 fall 2 slowstart 60s # maxconn 2048 maxqueue 128 weight 100
    server Primary 10.70.35.43:5432 check port 8084
    server Secondary 10.70.35.44:5432 check port 8084

userlist UsersFor_HAProxyStatistics
      group admin users admin
      user admin insecure-password pmx9p4r93hy4pn98h

listen HAProxy-Statistics 0.0.0.0:8000
      mode http
      stats enable
      stats uri /stats
      option contstats
      stats refresh 10s
      stats show-node
      stats show-legends
      acl AuthOkay_ReadOnly http_auth(UsersFor_HAProxyStatistics)
      acl AuthOkay_Admin http_auth_group(UsersFor_HAProxyStatistics) admin
      stats http-request auth realm HAProxy-Statistics unless AuthOkay_ReadOnly
      stats admin if AuthOkay_Admin

